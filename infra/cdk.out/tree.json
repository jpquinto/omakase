{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.238.0"},"children":{"OmakaseStack":{"id":"OmakaseStack","path":"OmakaseStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.238.0"},"children":{"OmakaseVpc":{"id":"OmakaseVpc","path":"OmakaseStack/OmakaseVpc","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.Vpc","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"OmakaseStack/OmakaseVpc/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnVPC","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::VPC","aws:cdk:cloudformation:props":{"cidrBlock":"10.0.0.0/16","enableDnsHostnames":true,"enableDnsSupport":true,"instanceTenancy":"default","tags":[{"key":"Name","value":"OmakaseStack/OmakaseVpc"}]}}},"PublicSubnet1":{"id":"PublicSubnet1","path":"OmakaseStack/OmakaseVpc/PublicSubnet1","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.PublicSubnet","version":"2.238.0"},"children":{"Subnet":{"id":"Subnet","path":"OmakaseStack/OmakaseVpc/PublicSubnet1/Subnet","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSubnet","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Subnet","aws:cdk:cloudformation:props":{"availabilityZone":"us-west-2a","cidrBlock":"10.0.0.0/24","mapPublicIpOnLaunch":true,"tags":[{"key":"aws-cdk:subnet-name","value":"Public"},{"key":"aws-cdk:subnet-type","value":"Public"},{"key":"Name","value":"OmakaseStack/OmakaseVpc/PublicSubnet1"}],"vpcId":{"Ref":"OmakaseVpc82E10B1F"}}}},"Acl":{"id":"Acl","path":"OmakaseStack/OmakaseVpc/PublicSubnet1/Acl","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.238.0"}},"RouteTable":{"id":"RouteTable","path":"OmakaseStack/OmakaseVpc/PublicSubnet1/RouteTable","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnRouteTable","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::RouteTable","aws:cdk:cloudformation:props":{"tags":[{"key":"Name","value":"OmakaseStack/OmakaseVpc/PublicSubnet1"}],"vpcId":{"Ref":"OmakaseVpc82E10B1F"}}}},"RouteTableAssociation":{"id":"RouteTableAssociation","path":"OmakaseStack/OmakaseVpc/PublicSubnet1/RouteTableAssociation","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSubnetRouteTableAssociation","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SubnetRouteTableAssociation","aws:cdk:cloudformation:props":{"routeTableId":{"Ref":"OmakaseVpcPublicSubnet1RouteTableB26A22AF"},"subnetId":{"Ref":"OmakaseVpcPublicSubnet1Subnet31AED316"}}}},"DefaultRoute":{"id":"DefaultRoute","path":"OmakaseStack/OmakaseVpc/PublicSubnet1/DefaultRoute","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnRoute","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Route","aws:cdk:cloudformation:props":{"destinationCidrBlock":"0.0.0.0/0","gatewayId":{"Ref":"OmakaseVpcIGWB2536E6A"},"routeTableId":{"Ref":"OmakaseVpcPublicSubnet1RouteTableB26A22AF"}}}}}},"IGW":{"id":"IGW","path":"OmakaseStack/OmakaseVpc/IGW","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnInternetGateway","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::InternetGateway","aws:cdk:cloudformation:props":{"tags":[{"key":"Name","value":"OmakaseStack/OmakaseVpc"}]}}},"VPCGW":{"id":"VPCGW","path":"OmakaseStack/OmakaseVpc/VPCGW","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnVPCGatewayAttachment","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::VPCGatewayAttachment","aws:cdk:cloudformation:props":{"internetGatewayId":{"Ref":"OmakaseVpcIGWB2536E6A"},"vpcId":{"Ref":"OmakaseVpc82E10B1F"}}}}}},"OrchestratorSG":{"id":"OrchestratorSG","path":"OmakaseStack/OrchestratorSG","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.SecurityGroup","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"OmakaseStack/OrchestratorSG/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroup","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroup","aws:cdk:cloudformation:props":{"groupDescription":"Omakase orchestrator - API and SSH access","securityGroupEgress":[{"cidrIp":"0.0.0.0/0","description":"Allow all outbound traffic by default","ipProtocol":"-1"}],"securityGroupIngress":[{"cidrIp":"0.0.0.0/0","ipProtocol":"tcp","fromPort":8080,"toPort":8080,"description":"Orchestrator API"},{"cidrIp":"0.0.0.0/0","ipProtocol":"tcp","fromPort":22,"toPort":22,"description":"SSH access"}],"vpcId":{"Ref":"OmakaseVpc82E10B1F"}}}}}},"OrchestratorLogGroup":{"id":"OrchestratorLogGroup","path":"OmakaseStack/OrchestratorLogGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"OmakaseStack/OrchestratorLogGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"logGroupName":"/omakase/orchestrator","retentionInDays":30}}}}},"ApiKeysSecret":{"id":"ApiKeysSecret","path":"OmakaseStack/ApiKeysSecret","constructInfo":{"fqn":"aws-cdk-lib.aws_secretsmanager.Secret","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"OmakaseStack/ApiKeysSecret/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_secretsmanager.CfnSecret","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SecretsManager::Secret","aws:cdk:cloudformation:props":{"description":"API keys used by Omakase (e.g. ANTHROPIC_API_KEY, GITHUB_TOKEN)","generateSecretString":{},"name":"omakase/api-keys"}}}}},"OrchestratorRole":{"id":"OrchestratorRole","path":"OmakaseStack/OrchestratorRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"OmakaseStack/OrchestratorRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"ec2.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/AmazonSSMManagedInstanceCore"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/CloudWatchAgentServerPolicy"]]}],"roleName":"omakase-orchestrator"}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"OmakaseStack/OrchestratorRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"OmakaseStack/OrchestratorRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["dynamodb:GetItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:Query","dynamodb:BatchWriteItem","dynamodb:Scan"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-west-2:211125619133:table/omakase-*","arn:aws:dynamodb:us-west-2:211125619133:table/omakase-*/index/*"],"Sid":"DynamoDbReadWrite"},{"Action":["secretsmanager:GetSecretValue","secretsmanager:DescribeSecret"],"Effect":"Allow","Resource":{"Ref":"ApiKeysSecret5A58C5CD"}},{"Action":["logs:CreateLogStream","logs:PutLogEvents"],"Effect":"Allow","Resource":{"Fn::GetAtt":["OrchestratorLogGroupE3FD5A7F","Arn"]}}],"Version":"2012-10-17"},"policyName":"OrchestratorRoleDefaultPolicy95E3A3CA","roles":[{"Ref":"OrchestratorRole4C17C129"}]}}}}}}},"KeyPair":{"id":"KeyPair","path":"OmakaseStack/KeyPair","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.238.0"}},"Orchestrator":{"id":"Orchestrator","path":"OmakaseStack/Orchestrator","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.Instance","version":"2.238.0"},"children":{"InstanceProfile":{"id":"InstanceProfile","path":"OmakaseStack/Orchestrator/InstanceProfile","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnInstanceProfile","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::InstanceProfile","aws:cdk:cloudformation:props":{"roles":[{"Ref":"OrchestratorRole4C17C129"}]}}},"Resource":{"id":"Resource","path":"OmakaseStack/Orchestrator/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnInstance","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Instance","aws:cdk:cloudformation:props":{"availabilityZone":"us-west-2a","blockDeviceMappings":[{"deviceName":"/dev/xvda","ebs":{"deleteOnTermination":false,"volumeSize":8,"volumeType":"gp3"}}],"iamInstanceProfile":{"Ref":"OrchestratorInstanceProfile81CC666C"},"imageId":{"Ref":"SsmParameterValueawsserviceamiamazonlinuxlatestal2023amikernel61x8664C96584B6F00A464EAD1953AFF4B05118Parameter"},"instanceType":"t3.micro","keyName":"omakase","securityGroupIds":[{"Fn::GetAtt":["OrchestratorSG6CDCE819","GroupId"]}],"subnetId":{"Ref":"OmakaseVpcPublicSubnet1Subnet31AED316"},"tags":[{"key":"Name","value":"OmakaseStack/Orchestrator"}],"userData":{"Fn::Base64":"#!/bin/bash\n#!/bin/bash\nset -euo pipefail\nexec > >(tee /var/log/user-data.log) 2>&1\n\necho '=== Omakase Bootstrap ==='\n\n# System updates\ndnf update -y\ndnf install -y git curl unzip tar\n\n# Install Node.js 20 (needed for Claude Code CLI)\ncurl -fsSL https://rpm.nodesource.com/setup_20.x | bash -\ndnf install -y nodejs\n\n# Install Bun\ncurl -fsSL https://bun.sh/install | bash\nexport BUN_INSTALL=\"/root/.bun\"\nexport PATH=\"$BUN_INSTALL/bin:$PATH\"\nln -sf /root/.bun/bin/bun /usr/local/bin/bun\nln -sf /root/.bun/bin/bunx /usr/local/bin/bunx\n\n# Install Claude Code CLI\nnpm install -g @anthropic-ai/claude-code\n\n# Install CloudWatch agent\ndnf install -y amazon-cloudwatch-agent\n\n# Create app directory\nmkdir -p /opt/omakase\nmkdir -p /opt/omakase/workspaces\n\n# Create systemd service\ncat > /etc/systemd/system/omakase-orchestrator.service << 'UNIT'\n[Unit]\nDescription=Omakase Orchestrator\nAfter=network.target\n\n[Service]\nType=simple\nUser=root\nWorkingDirectory=/opt/omakase/app/apps/orchestrator\nExecStart=/usr/local/bin/bun run start\nRestart=always\nRestartSec=5\nEnvironment=PORT=8080\nEnvironment=EXECUTION_MODE=local\nEnvironment=LOCAL_WORKSPACE_ROOT=/opt/omakase/workspaces\nEnvironment=DYNAMODB_TABLE_PREFIX=omakase-\nEnvironment=AWS_REGION=us-west-2\nEnvironment=PATH=/usr/local/bin:/root/.bun/bin:/usr/bin:/bin\n\n[Install]\nWantedBy=multi-user.target\nUNIT\n\nsystemctl daemon-reload\nsystemctl enable omakase-orchestrator\n\necho '=== Bootstrap complete ==='\necho 'To deploy: clone repo to /opt/omakase/app, run bun install, then systemctl start omakase-orchestrator'"}}}}}},"SsmParameterValue:--aws--service--ami-amazon-linux-latest--al2023-ami-kernel-6.1-x86_64:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter":{"id":"SsmParameterValue:--aws--service--ami-amazon-linux-latest--al2023-ami-kernel-6.1-x86_64:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter","path":"OmakaseStack/SsmParameterValue:--aws--service--ami-amazon-linux-latest--al2023-ami-kernel-6.1-x86_64:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.238.0"}},"SsmParameterValue:--aws--service--ami-amazon-linux-latest--al2023-ami-kernel-6.1-x86_64:C96584B6-F00A-464E-AD19-53AFF4B05118":{"id":"SsmParameterValue:--aws--service--ami-amazon-linux-latest--al2023-ami-kernel-6.1-x86_64:C96584B6-F00A-464E-AD19-53AFF4B05118","path":"OmakaseStack/SsmParameterValue:--aws--service--ami-amazon-linux-latest--al2023-ami-kernel-6.1-x86_64:C96584B6-F00A-464E-AD19-53AFF4B05118","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.238.0"}},"OrchestratorEIP":{"id":"OrchestratorEIP","path":"OmakaseStack/OrchestratorEIP","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnEIP","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::EIP","aws:cdk:cloudformation:props":{"domain":"vpc"}}},"EIPAssociation":{"id":"EIPAssociation","path":"OmakaseStack/EIPAssociation","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnEIPAssociation","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::EIPAssociation","aws:cdk:cloudformation:props":{"eip":{"Ref":"OrchestratorEIP"},"instanceId":{"Ref":"Orchestrator6EF1216F"}}}},"InstanceId":{"id":"InstanceId","path":"OmakaseStack/InstanceId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.238.0"}},"ElasticIp":{"id":"ElasticIp","path":"OmakaseStack/ElasticIp","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.238.0"}},"OrchestratorUrl":{"id":"OrchestratorUrl","path":"OmakaseStack/OrchestratorUrl","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.238.0"}},"SshCommand":{"id":"SshCommand","path":"OmakaseStack/SshCommand","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.238.0"}},"ApiKeysSecretArn":{"id":"ApiKeysSecretArn","path":"OmakaseStack/ApiKeysSecretArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.238.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"OmakaseStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.5"},"children":{"Default":{"id":"Default","path":"OmakaseStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.238.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"OmakaseStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.238.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"OmakaseStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.238.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.5"}}}}}